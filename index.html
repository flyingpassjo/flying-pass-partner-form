
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flying Pass 提携情報登録</title>
<link rel="preconnect" href="https://lh3.googleusercontent.com" crossorigin>
<link rel="dns-prefetch" href="//lh3.googleusercontent.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Noto Sans JP', sans-serif; background: #FAFBFC; color: #0F172A; }
a { color: inherit; }

/* Nav */
.nav { background: white; box-shadow: 0 2px 12px rgba(0,0,0,0.06); position: sticky; top: 0; z-index: 100; padding: 14px 24px; display: flex; justify-content: space-between; align-items: center; }
.nav-logo { display: flex; align-items: center; gap: 10px; }
.nav-logo-icon { background: #DC2626; color: white; font-weight: 800; font-size: 18px; padding: 6px 14px; border-radius: 8px; font-family: 'Outfit', sans-serif; }
.nav-logo-text { font-weight: 700; font-size: 15px; }
.nav-logo-img { height: 30px; width: auto; display: block; }
.nav-btn {
  background: linear-gradient(135deg, #DC2626 0%, #B91C1C 100%);
  color: white;
  border: 2px solid #FCA5A5;
  padding: 11px 22px;
  border-radius: 12px;
  font-weight: 900;
  font-size: 13px;
  cursor: pointer;
  font-family: 'Noto Sans JP', sans-serif;
  box-shadow: 0 8px 22px rgba(220,38,38,0.35);
  position: relative;
  overflow: hidden;
  animation: ctaPulse 1.8s infinite;
}
.nav-btn::after {
  content: '';
  position: absolute;
  top: -40%;
  left: -120%;
  width: 90%;
  height: 180%;
  transform: rotate(18deg);
  background: rgba(255,255,255,0.22);
  animation: ctaShine 2.4s ease-in-out infinite;
}
.nav-btn:hover { transform: translateY(-1px); }
.nav-back { background: none; border: none; font-size: 14px; color: #64748B; cursor: pointer; font-weight: 600; font-family: 'Noto Sans JP', sans-serif; }

/* Banner */
.banner { background: #DC2626; color: white; text-align: center; padding: 10px 16px; font-size: 13px; font-weight: 700; letter-spacing: 0.02em; }

/* Hero */
.hero { background: linear-gradient(135deg, #0F172A 0%, #1E3A5F 100%); color: white; padding: 60px 24px; text-align: center; }
.hero-badge { display: inline-block; background: rgba(245,158,11,0.15); color: #F59E0B; padding: 6px 16px; border-radius: 20px; font-size: 13px; font-weight: 700; margin-bottom: 20px; border: 1px solid rgba(245,158,11,0.3); }
.hero h1 { font-size: clamp(22px, 5vw, 34px); font-weight: 900; line-height: 1.4; margin-bottom: 16px; }
.hero h1 span { color: #F59E0B; }
.hero p { font-size: 14px; opacity: 0.85; line-height: 1.9; max-width: 600px; margin: 0 auto; }

/* Form Hero */
.form-hero { background: linear-gradient(135deg, #0F172A 0%, #1E3A5F 100%); color: white; padding: 36px 24px; text-align: center; }
.form-hero h2 { font-size: clamp(18px, 4vw, 24px); font-weight: 900; margin-bottom: 8px; }
.form-hero p { font-size: 13px; opacity: 0.8; }

/* Container */
.container { max-width: 760px; margin: 0 auto; padding: 32px 20px 0; }
.form-container { max-width: 640px; margin: 0 auto; padding: 0 20px 60px; }

/* Info Card */
.info-intro { background: white; border-radius: 14px; padding: 24px; border: 1px solid #E2E8F0; box-shadow: 0 2px 8px rgba(0,0,0,0.04); font-size: 14px; line-height: 1.9; color: #334155; margin-bottom: 32px; }

/* Section */
.info-section { margin-bottom: 32px; }
.info-section-header { display: flex; align-items: center; gap: 12px; margin-bottom: 14px; }
.section-number { background: #DC2626; color: white; width: 30px; height: 30px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 800; font-family: 'Outfit', sans-serif; }
.info-section-header h2 { font-size: 17px; font-weight: 900; }
.info-card { background: white; border-radius: 14px; padding: 20px; border: 1px solid #E2E8F0; margin-bottom: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.04); }

/* Info Item */
.info-item { font-size: 14px; line-height: 1.8; color: #334155; margin-bottom: 16px; }
.info-item:last-child { margin-bottom: 0; }
.info-item-title { font-weight: 700; margin-bottom: 4px; display: flex; align-items: center; gap: 8px; }
.info-item-dot { width: 6px; height: 6px; border-radius: 50%; background: #DC2626; flex-shrink: 0; }
.info-item-body { padding-left: 14px; }

/* Stats */
.stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px; margin-top: 16px; }
.stat-box { background: white; border-radius: 12px; padding: 16px 12px; text-align: center; border: 1px solid #E2E8F0; }
.stat-value { font-size: 22px; font-weight: 900; color: #DC2626; font-family: 'Outfit', sans-serif; }
.stat-label { font-size: 11px; color: #64748B; margin-top: 4px; }

/* Rank Warning */
.rank-warning { background: #FEF3C7; border: 1px solid #F59E0B; border-radius: 10px; padding: 16px; margin-bottom: 16px; }
.rank-warning-title { font-size: 13px; font-weight: 700; color: #92400E; margin-bottom: 10px; }
.rank-boxes { display: flex; gap: 12px; flex-wrap: wrap; }
.rank-box { background: white; padding: 12px 18px; border-radius: 8px; font-size: 14px; font-weight: 600; flex: 1 1 140px; border: 1px solid #FDE68A; }
.rank-box small { font-size: 12px; color: #64748B; font-weight: 400; }

/* Staff Guide */
.staff-guide { display: flex; gap: 12px; padding: 12px 14px; background: #F8FAFC; border-radius: 10px; font-size: 13px; line-height: 1.7; align-items: flex-start; margin-bottom: 10px; }
.staff-guide:last-child { margin-bottom: 0; }
.staff-check { background: #DC2626; color: white; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px; font-size: 10px; }

/* LINE Button */
.line-btn { display: inline-flex; align-items: center; gap: 8px; background: #06C755; color: white; padding: 14px 28px; border-radius: 10px; font-size: 14px; font-weight: 700; text-decoration: none; box-shadow: 0 4px 14px rgba(6,199,85,0.3); }
.line-btn-big { padding: 16px 32px; font-size: 16px; font-weight: 800; border-radius: 14px; box-shadow: 0 6px 24px rgba(6,199,85,0.4); width: 100%; justify-content: center; }

/* LINE Important */
.line-important { background: #FEF2F2; border: 1px solid #FECACA; border-radius: 10px; padding: 16px; margin-bottom: 16px; }
.line-important h4 { font-size: 14px; font-weight: 800; color: #DC2626; margin-bottom: 8px; }
.line-important p { font-size: 13px; color: #334155; line-height: 1.8; }

/* Contact */
.contact-box { background: #F1F5F9; border-radius: 14px; padding: 24px; margin-top: 8px; margin-bottom: 24px; }
.contact-row { display: flex; gap: 8px; font-size: 14px; color: #334155; margin-bottom: 8px; }
.contact-label { color: #64748B; min-width: 60px; }

/* CTA */
.cta-box { background: linear-gradient(135deg, #DC2626 0%, #B91C1C 100%); border-radius: 16px; padding: 36px 24px; text-align: center; color: white; margin-bottom: 40px; }
.cta-box h3 { font-size: 18px; font-weight: 900; margin-bottom: 10px; }
.cta-box p { font-size: 13px; opacity: 0.9; line-height: 1.7; margin-bottom: 24px; }
.cta-btn {
  background: white;
  color: #B91C1C;
  border: 2px solid #FCA5A5;
  padding: 15px 38px;
  border-radius: 12px;
  font-weight: 900;
  font-size: 16px;
  cursor: pointer;
  box-shadow: 0 8px 22px rgba(0,0,0,0.24);
  font-family: 'Noto Sans JP', sans-serif;
  position: relative;
  overflow: hidden;
  animation: ctaPulse 1.8s infinite;
}
.cta-btn::after {
  content: '';
  position: absolute;
  top: -35%;
  left: -120%;
  width: 90%;
  height: 170%;
  transform: rotate(18deg);
  background: rgba(255,255,255,0.45);
  animation: ctaShine 2.2s ease-in-out infinite;
}
.cta-btn:hover { transform: translateY(-1px); }

/* Partner Banner */
.partner-banner { background: #0F172A; border-radius: 16px; padding: 20px; margin-bottom: 20px; color: white; }
.partner-banner-logo { display: inline-flex; align-items: center; margin-bottom: 14px; }
.partner-banner-logo img { height: 28px; width: auto; }
.partner-links { display: grid; grid-template-columns: repeat(auto-fit, minmax(170px, 1fr)); gap: 8px; }
.partner-link { display: block; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.16); border-radius: 10px; padding: 10px 12px; font-size: 12px; color: #E2E8F0; text-decoration: none; }
.partner-link:hover { background: rgba(255,255,255,0.12); }

/* Footer */
.footer { background: #0F172A; color: #94A3B8; padding: 24px; text-align: center; font-size: 12px; }

/* Future Item */
.future-item { display: flex; gap: 12px; align-items: flex-start; margin-bottom: 14px; }
.future-item:last-child { margin-bottom: 0; }
.future-dot { width: 6px; height: 6px; border-radius: 50%; background: #DC2626; flex-shrink: 0; margin-top: 8px; }
.future-title { font-size: 14px; font-weight: 700; }
.future-desc { font-size: 13px; color: #64748B; }

/* Closing */
.closing { text-align: center; font-size: 14px; color: #334155; line-height: 1.9; margin-bottom: 24px; padding: 0 8px; }
.closing .sig { margin-top: 16px; font-weight: 700; }

/* ====== FORM STYLES ====== */
.form-section { background: white; border-radius: 16px; padding: 24px; margin-bottom: 20px; border: 1px solid #E2E8F0; box-shadow: 0 2px 8px rgba(0,0,0,0.04); }
.form-section-header { display: flex; align-items: center; gap: 10px; margin-bottom: 20px; }
.form-section-num { background: #DC2626; color: white; width: 28px; height: 28px; border-radius: 7px; display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 800; font-family: 'Outfit', sans-serif; }
.form-section-header h3 { font-size: 16px; font-weight: 800; }

.form-field { margin-bottom: 16px; }
.form-field label { display: block; font-size: 14px; font-weight: 700; margin-bottom: 6px; }
.form-field .req { color: #DC2626; }
.form-input { width: 100%; padding: 10px 14px; border-radius: 8px; border: 1px solid #E2E8F0; font-size: 14px; outline: none; font-family: 'Noto Sans JP', sans-serif; background: white; }
.form-input:focus { border-color: #DC2626; }
.form-hint { font-size: 11px; color: #94A3B8; margin-top: 4px; }
select.form-input { appearance: auto; }
.postal-row { display: flex; gap: 8px; align-items: center; }
.postal-btn { background: #0F172A; color: white; border: none; border-radius: 8px; padding: 10px 14px; font-size: 13px; font-weight: 700; cursor: pointer; font-family: 'Noto Sans JP', sans-serif; white-space: nowrap; }
.postal-btn:disabled { background: #CBD5E1; cursor: not-allowed; }

/* Process Steps */
.process-box { background: white; border-radius: 14px; padding: 20px; border: 1px solid #E2E8F0; margin-bottom: 24px; }
.process-box h3 { font-size: 15px; font-weight: 800; margin-bottom: 16px; text-align: center; }
.process-step { display: flex; gap: 14px; align-items: flex-start; }
.process-step-line { display: flex; flex-direction: column; align-items: center; }
.process-num { width: 28px; height: 28px; border-radius: 50%; background: #DC2626; color: white; display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 800; font-family: 'Outfit', sans-serif; flex-shrink: 0; }
.process-line { width: 2px; height: 28px; background: #E2E8F0; }
.process-content { padding-bottom: 12px; }
.process-title { font-size: 14px; font-weight: 700; }
.process-desc { font-size: 12px; color: #64748B; line-height: 1.6; }

/* Benefits */
.benefit-note { background: #F8FAFC; border: 1px solid #E2E8F0; border-radius: 10px; padding: 14px; margin-bottom: 20px; font-size: 13px; color: #334155; line-height: 1.7; }
.benefit-row { display: flex; align-items: center; gap: 10px; padding: 12px 14px; border-radius: 10px; margin-bottom: 8px; border: 1px solid #E2E8F0; background: #F8FAFC; flex-wrap: wrap; transition: all 0.2s; }
.benefit-row.active { background: #FEF2F2; border-color: #FECACA; }
.benefit-label { display: flex; align-items: center; gap: 8px; cursor: pointer; flex: 1 1 auto; min-width: 160px; }
.benefit-label input { accent-color: #DC2626; width: 18px; height: 18px; }
.benefit-label span { font-size: 14px; font-weight: 600; color: #475569; }
.benefit-row.active .benefit-label span { color: #DC2626; }
.benefit-max { display: flex; align-items: center; gap: 6px; }
.benefit-max span { font-size: 12px; color: #94A3B8; white-space: nowrap; }
.benefit-max input { width: 80px; padding: 6px 8px; font-size: 13px; text-align: right; border: 1px solid #E2E8F0; border-radius: 8px; outline: none; font-family: 'Noto Sans JP', sans-serif; }
.benefit-tip { font-size: 13px; color: #DC2626; font-weight: 600; margin-top: 12px; padding: 10px 14px; background: #FEF2F2; border-radius: 8px; line-height: 1.6; }
.min-amount { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
.min-amount span { font-size: 14px; font-weight: 600; white-space: nowrap; }
.min-amount input { width: 110px; text-align: right; }

/* Time */
.schedule-toggle { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 16px; }
.radio-opt { display: flex; align-items: center; gap: 8px; padding: 10px 18px; border-radius: 10px; cursor: pointer; font-size: 14px; font-weight: 600; border: 2px solid #E2E8F0; background: white; color: #475569; transition: all 0.2s; }
.radio-opt.active { border-color: #DC2626; background: #FEF2F2; color: #DC2626; }
.radio-dot { width: 18px; height: 18px; border-radius: 50%; border: 2px solid #CBD5E1; transition: all 0.2s; }
.radio-opt.active .radio-dot { border: 5px solid #DC2626; }
.time-row { display: flex; align-items: center; gap: 10px; margin-bottom: 16px; flex-wrap: wrap; }
.time-select { padding: 8px 12px; border: 1px solid #E2E8F0; border-radius: 8px; font-size: 14px; font-family: 'Noto Sans JP', sans-serif; outline: none; background: white; }
.time-select-small { padding: 6px 8px; font-size: 13px; width: 90px; }
.time-separator { font-size: 18px; color: #94A3B8; }
.time-label { font-size: 11px; color: #94A3B8; }
.break-check { display: flex; align-items: center; gap: 8px; font-size: 13px; font-weight: 600; cursor: pointer; margin-bottom: 8px; }
.break-check input { accent-color: #DC2626; width: 16px; height: 16px; }
.break-times { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; padding-left: 24px; }

/* Holiday buttons */
.holiday-btns { display: flex; gap: 6px; flex-wrap: wrap; }
.holiday-btn { padding: 8px 14px; border-radius: 8px; font-weight: 600; font-size: 13px; cursor: pointer; border: 1px solid #E2E8F0; background: white; color: #475569; transition: all 0.2s; font-family: 'Noto Sans JP', sans-serif; }
.holiday-btn.active { border: 2px solid #DC2626; background: #FEF2F2; color: #DC2626; }
.holiday-btn.nenkyu { border-color: #E2E8F0; }
.holiday-btn.nenkyu.active { border: 2px solid #059669; background: #ECFDF5; color: #059669; }

/* Weekly */
.weekly-row { display: flex; align-items: center; gap: 10px; padding: 10px 14px; border-radius: 10px; border: 1px solid #E2E8F0; margin-bottom: 8px; flex-wrap: wrap; background: white; }
.weekly-row.closed { background: #F8FAFC; }
.weekly-day { font-weight: 700; font-size: 14px; width: 24px; }
.weekly-day.off { color: #94A3B8; }
.weekly-close-label { display: flex; align-items: center; gap: 6px; font-size: 12px; color: #94A3B8; cursor: pointer; margin-left: auto; }
.weekly-close-label input { accent-color: #DC2626; }
.example-btn { margin-top: 12px; background: none; border: 1px dashed #CBD5E1; border-radius: 8px; padding: 8px 14px; font-size: 12px; color: #64748B; cursor: pointer; width: 100%; font-family: 'Noto Sans JP', sans-serif; }
.example-box { margin-top: 8px; background: #F8FAFC; border-radius: 8px; padding: 14px; font-size: 13px; color: #475569; line-height: 1.8; }

/* Targets */
.target-btns { display: flex; flex-wrap: wrap; gap: 8px; }
.target-btn { padding: 10px 18px; border-radius: 10px; font-weight: 600; font-size: 13px; cursor: pointer; border: 1px solid #E2E8F0; background: white; color: #475569; transition: all 0.2s; font-family: 'Noto Sans JP', sans-serif; }
.target-btn.active { border: 2px solid #DC2626; background: #FEF2F2; color: #DC2626; }

/* Utility Info */
.check-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 8px; }
.check-chip { display: grid; grid-template-columns: 18px minmax(0, 1fr); align-items: start; column-gap: 10px; border: 1px solid #DDE4EE; border-radius: 14px; background: #FAFBFF; padding: 12px 14px; font-size: 13px; line-height: 1.4; color: #1F2937; cursor: pointer; transition: all .18s ease; box-shadow: 0 1px 2px rgba(15,23,42,0.03); word-break: keep-all; }
.check-chip:hover { border-color: #B8CCFF; background: #F2F7FF; transform: translateY(-1px); }
.check-chip input { appearance: none; -webkit-appearance: none; width: 18px; height: 18px; margin: 1px 0 0; border-radius: 6px; border: 1.5px solid #C7D2E2; background: white; position: relative; transition: all .15s ease; }
.check-chip-text { display: block; min-width: 0; padding-top: 1px; line-height: 1.35; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.check-chip input:checked { border-color: #3182F6; background: #3182F6; }
.check-chip input:checked::after { content: ''; position: absolute; left: 5px; top: 1px; width: 5px; height: 10px; border: solid #fff; border-width: 0 2px 2px 0; transform: rotate(45deg); }
.check-chip.active,
.check-chip:has(input:checked) { border-color: #3182F6; background: #EFF5FF; box-shadow: 0 2px 10px rgba(49,130,246,0.12); color: #1B4DB8; font-weight: 700; }

/* Menu input */
.menu-row { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
.menu-num { background: #DC2626; color: white; width: 22px; height: 22px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 700; flex-shrink: 0; }

/* Upload */
.upload-area { border: 2px dashed #CBD5E1; border-radius: 12px; padding: 28px; text-align: center; background: white; cursor: pointer; transition: border-color 0.2s; }
.upload-area:hover { border-color: #DC2626; }
.upload-title { font-size: 14px; color: #475569; margin-bottom: 4px; font-weight: 600; }
.upload-hint { font-size: 12px; color: #94A3B8; }
.upload-note { font-size: 12px; color: #64748B; margin-top: 8px; line-height: 1.7; }
.upload-preview { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 12px; }
.upload-thumb { width: 80px; height: 80px; border-radius: 8px; object-fit: cover; border: 1px solid #E2E8F0; }
.upload-item { position: relative; }
.upload-remove { position: absolute; top: -6px; right: -6px; width: 20px; height: 20px; border-radius: 50%; background: #DC2626; color: white; border: none; font-size: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
.upload-status { margin-top: 8px; font-size: 12px; color: #64748B; }

/* Agreement */
.agree-list { background: #F8FAFC; border-radius: 10px; padding: 16px; font-size: 13px; color: #334155; line-height: 1.9; margin-bottom: 16px; }
.agree-list ol { margin: 0; padding-left: 18px; }
.agree-list li { margin-bottom: 6px; }
.agree-list li:last-child { margin-bottom: 0; }
.agree-check { display: grid; grid-template-columns: 19px minmax(0, 1fr); align-items: start; column-gap: 10px; cursor: pointer; padding: 13px 14px; border-radius: 12px; border: 1.5px solid #DDE4EE; background: #FBFCFF; transition: all 0.2s; }
.agree-check.active { border-color: #3182F6; background: #EFF5FF; box-shadow: 0 2px 12px rgba(49,130,246,0.14); }
.agree-check input { appearance: none; -webkit-appearance: none; width: 19px; height: 19px; margin: 1px 0 0; border-radius: 6px; border: 1.5px solid #C7D2E2; background: white; position: relative; }
.agree-check input:checked { border-color: #3182F6; background: #3182F6; }
.agree-check input:checked::after { content: ''; position: absolute; left: 5px; top: 1px; width: 5px; height: 10px; border: solid #fff; border-width: 0 2px 2px 0; transform: rotate(45deg); }
.agree-check span { font-size: 14px; font-weight: 700; color: #344256; }
.agree-check.active span { color: #1B4DB8; }

/* Submit */
.submit-btn { width: 100%; padding: 16px 32px; border-radius: 12px; font-size: 16px; font-weight: 800; border: none; color: white; cursor: pointer; transition: all 0.3s; font-family: 'Noto Sans JP', sans-serif; display: flex; align-items: center; justify-content: center; gap: 8px; }
.submit-btn.ready { background: linear-gradient(135deg, #DC2626 0%, #B91C1C 100%); box-shadow: 0 4px 20px rgba(220,38,38,0.3); }
.submit-btn.disabled { background: #CBD5E1; cursor: not-allowed; }
.submit-hint { text-align: center; font-size: 12px; color: #94A3B8; margin-top: 10px; }
.submit-error { background: #FEF2F2; border: 1px solid #FECACA; border-radius: 10px; padding: 14px; margin-bottom: 16px; font-size: 13px; color: #DC2626; text-align: center; }

/* Spinner */
@keyframes spin { to { transform: rotate(360deg); } }
.spinner { width: 18px; height: 18px; border: 2px solid rgba(255,255,255,0.3); border-top: 2px solid white; border-radius: 50%; animation: spin 0.8s linear infinite; }
@keyframes ctaPulse {
  0% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.45); }
  70% { box-shadow: 0 0 0 16px rgba(220, 38, 38, 0); }
  100% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0); }
}
@keyframes ctaShine {
  0% { left: -120%; }
  100% { left: 160%; }
}

/* Success */
.success-page { min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; background: linear-gradient(135deg, #0F172A 0%, #1E3A5F 100%); color: white; padding: 24px; text-align: center; }
.success-card { background: rgba(255,255,255,0.1); backdrop-filter: blur(20px); border-radius: 24px; padding: 48px 32px; max-width: 440px; width: 100%; border: 1px solid rgba(255,255,255,0.15); }
.success-icon { width: 72px; height: 72px; background: linear-gradient(135deg, #059669, #10B981); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 24px; box-shadow: 0 8px 30px rgba(5,150,105,0.3); }
.success-card h2 { font-size: 22px; font-weight: 900; margin-bottom: 8px; }
.success-card p { font-size: 14px; opacity: 0.8; line-height: 1.7; margin-bottom: 32px; }
.success-note { margin-top: 24px; padding: 14px 16px; background: rgba(255,255,255,0.08); border-radius: 10px; font-size: 12px; color: rgba(255,255,255,0.6); line-height: 1.7; }
.countdown { font-size: 12px; opacity: 0.6; margin-top: 8px; }
.post-upload-status { margin-top: 12px; font-size: 12px; line-height: 1.6; color: rgba(255,255,255,0.75); min-height: 20px; }
.post-upload-retry { margin-top: 10px; padding: 10px 14px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.35); color: #fff; background: rgba(255,255,255,0.12); font-size: 12px; font-weight: 700; cursor: pointer; }
.post-upload-retry.hidden { display: none; }

/* Hidden */
.hidden { display: none !important; }

@media (max-width: 640px) {
  .nav {
    flex-wrap: wrap;
    gap: 10px;
  }
  .nav-logo {
    width: 100%;
  }
  .nav-logo-img {
    height: 24px;
  }
  .nav-btn {
    width: 100%;
    text-align: center;
    padding: 11px 14px;
    font-size: 12px;
    border-radius: 10px;
  }
  .check-grid {
    grid-template-columns: 1fr;
  }
  .check-chip {
    min-height: 46px;
  }
}
</style>
</head>
<body>

<!-- =================== INFO PAGE =================== -->
<div id="infoPage">
  <div class="banner">【重要】Flying Pass 本格始動に伴うご案内とご協力のお願い</div>

  <nav class="nav">
    <a class="nav-logo" href="https://flyingjp.net/" target="_blank" rel="noopener noreferrer">
      <img class="nav-logo-img" src="https://lh3.googleusercontent.com/d/1z_KJ-l3SuqBaM5Irb_bBAMNCq8mQuc2x=s3000" alt="FLYING JAPAN">
    </a>
    <button class="nav-btn" onclick="showForm()">情報登録フォームへ →</button>
  </nav>

  <section class="hero">
    <div style="max-width:720px;margin:0 auto">
      <div class="hero-badge">既存提携パートナー様向けご案内</div>
      <h1>訪日韓国人向け「Flying Pass」<br><span>本格始動</span>のご案内</h1>
      <p>いつも大変お世話になっております。株式会社Flying Japanでございます。<br>平素より、弊社サービスへの多大なるご協力をいただき、<br>誠にありがとうございます。</p>
    </div>
  </section>

  <div class="container">
    <div class="info-intro">
      この度、韓国人旅行者向け特典プラットフォーム「Flying Pass（フライングパス）」の本格的な運用開始に伴い、システムの運用方法および店舗スタッフ様への共有事項をご連絡させていただきます。<br>
      ご多忙の折恐縮ですが、ご確認のほどよろしくお願い申し上げます。
    </div>
  </div>

  <div class="container" style="padding-top:0">
    <!-- Section 1 -->
    <div class="info-section">
      <div class="info-section-header">
        <div class="section-number">1</div>
        <h2>フライングパス使用概要</h2>
      </div>
      <div class="info-card">
        <div class="info-item">
          <div class="info-item-title"><div class="info-item-dot"></div>韓国人旅行者向け正式Webサイト公開</div>
          <div class="info-item-body">公式サイト（<a href="https://flying-pass.com" target="_blank" style="color:#DC2626;font-weight:600">flying-pass.com</a>）にて、提携店舗リストや特典情報が公開されております。</div>
        </div>
        <div class="info-item">
          <div class="info-item-title"><div class="info-item-dot"></div>旅行者への配布と送客強化</div>
          <div class="info-item-body">現在「エディオンなんば」のトラベルセンターにて、<strong>1日平均200名以上</strong>の旅行者へ「ホワイトパス（実物カード）」を配布し、送客を強化しています。すでに貴店の情報は掲載されておりますので、お客様の来店時にはすぐに特典の提供が出来る準備をお願い致します。</div>
        </div>
      </div>
      <div class="stats-grid">
        <div class="stat-box"><div class="stat-value">62万+</div><div class="stat-label">コミュニティ会員</div></div>
        <div class="stat-box"><div class="stat-value">1万人/月</div><div class="stat-label">センター来訪者</div></div>
        <div class="stat-box"><div class="stat-value">200+/日</div><div class="stat-label">パス配布数</div></div>
      </div>
    </div>

    <!-- Section 2 -->
    <div class="info-section">
      <div class="info-section-header">
        <div class="section-number">2</div>
        <h2>会員ランクおよび特典利用ルール</h2>
      </div>
      <div class="info-card">
        <p style="font-size:14px;line-height:1.8;margin-bottom:16px;color:#334155">
          Flying Passは全<strong>6ランク</strong>（ホワイト / ブルー / シルバー / ゴールド / プラチナ / ブラック）で構成されています。<br>
          「ホワイトパス」以外のランクのお客様が利用する場合には、以下の2点を提示していただくようご案内しております。
        </p>
        <div class="rank-warning">
          <div class="rank-warning-title">お客様への確認事項（ホワイトパス以外）</div>
          <div class="rank-boxes">
            <div class="rank-box">1. 実物カード</div>
            <div class="rank-box">2. スマートフォンのWEB画面<br><small>（「特典を使用する」ボタン）</small></div>
          </div>
        </div>
        <p style="font-size:13px;color:#64748B;line-height:1.7">※ お客様がスマホ画面で「特典を使用する」ボタンを押すと利用履歴が自動記録されます。</p>
      </div>
    </div>

    <!-- Section 3 -->
    <div class="info-section">
      <div class="info-section-header">
        <div class="section-number">3</div>
        <h2>現場スタッフ様へのご共有願い</h2>
      </div>
      <div class="info-card">
        <p style="font-size:14px;line-height:1.8;margin-bottom:16px;color:#334155">
          韓国人のお客様が来店された際、スムーズなご案内ができるよう、以下の点を現場の皆様へご共有いただけますでしょうか。
        </p>
        <div class="staff-guide">
          <div class="staff-check">✓</div>
          <div><span style="font-weight:700">特典適用の確認：</span><span style="color:#475569">会計時に「実物カード」と「スマホ画面」の両方を確認してください。（※ホワイトパスの場合はカードのみ）</span></div>
        </div>
        <div class="staff-guide">
          <div class="staff-check">✓</div>
          <div><span style="font-weight:700">ステッカーの認識：</span><span style="color:#475569">お客様は店頭の「提携ステッカー」を目印に来店されます。</span></div>
        </div>
        <div class="staff-guide">
          <div class="staff-check">✓</div>
          <div><span style="font-weight:700">接客について：</span><span style="color:#475569">日本語でのコミュニケーションに不安を感じるお客様も多いため、画面とカードの提示だけで特典を適用していただけますと、お客様の安心感・満足度向上につながります。</span></div>
        </div>
      </div>
    </div>

    <!-- Section 4 -->
    <div class="info-section">
      <div class="info-section-header">
        <div class="section-number">4</div>
        <h2>特典内容のご確認とLINE登録のお願い</h2>
      </div>
      <div class="info-card">
        <div style="margin-bottom:20px">
          <h4 style="font-size:14px;font-weight:700;margin-bottom:8px">現在登録されている特典内容</h4>
          <div style="background:#F1F5F9;padding:14px;border-radius:8px;font-size:13px;color:#475569;border-left:3px solid #DC2626">
            例：○○をご注文の方にドリンク1杯無料
          </div>
        </div>
        <div class="line-important">
          <h4>【重要】LINE公式アカウント登録のお願い</h4>
          <p>特典内容の変更や追加、集客のご相談、および今後の重要なお知らせやレポート送付は、すべて「LINE公式アカウント」にて一元管理いたします。お問い合わせもLINEが最もスムーズに対応可能ですので、以下より「友だち追加」をお願いいたします。</p>
        </div>
        <div style="text-align:center;padding:8px 0">
          <p style="font-size:13px;font-weight:600;color:#475569;margin-bottom:12px">LINE公式アカウント（店舗様専用）</p>
          <a href="https://line.me/R/ti/p/@864mbroc" target="_blank" class="line-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="white"><path d="M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63h2.386c.346 0 .627.285.627.63 0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211 0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346 0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195 0 .375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345 0 .63.285.63.63v4.771zm-5.741 0c0 .344-.282.629-.631.629-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63.346 0 .628.285.628.63v4.771zm-2.466.629H4.917c-.345 0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.63 0 .344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314"/></svg>
            LINEで友だち追加する
          </a>
        </div>
      </div>
    </div>

    <!-- CTA -->
    <div class="cta-box">
      <h3>提携情報の更新にご協力ください</h3>
      <p>新しいプラットフォームに掲載する店舗情報を<br>以下のフォームからご登録をお願いいたします。</p>
      <button class="cta-btn" onclick="showForm()">情報登録フォームへ進む →</button>
    </div>

    <!-- Future -->
    <div class="info-section">
      <div class="info-section-header">
        <h2>今後のスケジュール</h2>
      </div>
      <div class="info-card">
        <div class="future-item">
          <div class="future-dot"></div>
          <div><div class="future-title">入店ガイド申請フォーム</div><div class="future-desc">LINEを通じて別途ご案内</div></div>
        </div>
        <div class="future-item">
          <div class="future-dot"></div>
          <div><div class="future-title">レビュー施策のご提案</div><div class="future-desc">ブラック/プラチナ会員を対象としたレビュー投稿企画を予定</div></div>
        </div>
      </div>
    </div>

    <!-- Contact -->
    <div class="contact-box">
      <h4 style="font-size:14px;font-weight:700;margin-bottom:12px">お問い合わせ</h4>
      <div class="contact-row"><span class="contact-label">Email</span><span style="font-weight:600">pass@flyingjp.com</span></div>
      <div class="contact-row"><span class="contact-label">LINE</span><a href="https://line.me/R/ti/p/@864mbroc" target="_blank" style="color:#06C755;font-weight:600">友だち追加はこちら</a></div>
    </div>

    <!-- Closing -->
    <div class="closing">
      <p>より多くの韓国人観光客が貴店を訪れ、売上に貢献できるよう、<br>運営一同尽力してまいります。<br>今後とも良きパートナーとして、末永いお付き合いをいただけますと幸いです。</p>
      <p class="sig">株式会社Flying Japan一同</p>
    </div>
  </div>

  <footer class="footer">
    <div style="max-width:760px;margin:0 auto;">
      <div class="partner-banner" style="margin-bottom:14px;">
        <a class="partner-banner-logo" href="https://flyingjp.net/" target="_blank" rel="noopener noreferrer">
         <img src="https://lh3.googleusercontent.com/d/1uU92iQ5TQ3hmCd2k4C4bolzhTlDt9-Te=s3000" alt="FLYING JAPAN">
        </a>
        <div class="partner-links">
          <a class="partner-link" href="https://flying-pass.com/" target="_blank" rel="noopener noreferrer">FLYING PASS</a>
          <a class="partner-link" href="https://cafe.naver.com/d2d2d2" target="_blank" rel="noopener noreferrer">NAVER カフェ</a>
          <a class="partner-link" href="https://maps.app.goo.gl/bUgPdXCC78whuixAA" target="_blank" rel="noopener noreferrer">なんば旅行者センター</a>
          <a class="partner-link" href="https://line.me/R/ti/p/@864mbroc" target="_blank" rel="noopener noreferrer">LINE 公式アカウント</a>
          <a class="partner-link" href="https://flyingjp.net/" target="_blank" rel="noopener noreferrer">FLYING JAPAN 公式サイト</a>
          <a class="partner-link" href="https://www.nikkei.com/article/DGXZQOUF177FU0X10C24A6000000/" target="_blank" rel="noopener noreferrer">日経掲載記事</a>
        </div>
      </div>
      <div>&copy; 2026 Flying Japan Inc. All rights reserved.</div>
    </div>
  </footer>
</div>

<!-- =================== FORM PAGE =================== -->
<div id="formPage" class="hidden">
  <nav class="nav">
    <button class="nav-back" onclick="showInfo()">← 戻る</button>
    <a class="nav-logo" href="https://flyingjp.net/" target="_blank" rel="noopener noreferrer">
      <img class="nav-logo-img" src="https://lh3.googleusercontent.com/d/1z_KJ-l3SuqBaM5Irb_bBAMNCq8mQuc2x=s3000" alt="FLYING JAPAN">
    </a>
  </nav>

  <div class="form-hero">
    <h2>提携店舗 情報登録フォーム</h2>
    <p>Flying Pass プラットフォームに掲載する情報をご入力ください</p>
  </div>

  <!-- Process -->
  <div style="max-width:640px;margin:0 auto;padding:24px 20px 0">
    <div class="process-box">
      <h3>提携手続きの流れ</h3>
      <div class="process-step">
        <div class="process-step-line"><div class="process-num">1</div><div class="process-line"></div></div>
        <div class="process-content"><div class="process-title">情報登録フォームの提出</div><div class="process-desc">以下の必要事項にご記入・ご提出をお願いいたします。</div></div>
      </div>
      <div class="process-step">
        <div class="process-step-line"><div class="process-num">2</div><div class="process-line"></div></div>
        <div class="process-content"><div class="process-title">内容の確認</div><div class="process-desc">ご提出いただいた情報をもとに、掲載内容を確認いたします。</div></div>
      </div>
      <div class="process-step">
        <div class="process-step-line"><div class="process-num">3</div><div class="process-line"></div></div>
        <div class="process-content"><div class="process-title">プラットフォームへの掲載</div><div class="process-desc">確認完了後、Flying Pass上の店舗情報を更新いたします。</div></div>
      </div>
      <div class="process-step">
        <div class="process-step-line"><div class="process-num">4</div></div>
        <div class="process-content" style="padding-bottom:0"><div class="process-title">「フライングパス」特典のご提供</div><div class="process-desc">フライングパス1枚のご提示につき、特典を1つご提供ください。</div></div>
      </div>
    </div>
  </div>

  <div class="form-container">

    <!-- Section 1: Store Info -->
    <div class="form-section">
      <div class="form-section-header"><div class="form-section-num">1</div><h3>店舗基本情報</h3></div>
      <div class="form-field"><label>会社名（店舗名）<span class="req">*</span></label><input type="text" id="companyName" class="form-input" placeholder="例：焼肉○○ 難波本店" required></div>
      <div class="form-field"><label>担当者名 <span class="req">*</span></label><input type="text" id="contactName" class="form-input" placeholder="例：田中太郎" required></div>
      <div class="form-field"><label>担当者連絡先（LINE 又は 電話番号）<span class="req">*</span></label><input type="text" id="contactInfo" class="form-input" placeholder="例：06-1234-5678 又は LINE ID" required></div>
      <div class="form-field"><label>メールアドレス <span class="req">*</span></label><input type="email" id="email" class="form-input" placeholder="例：info@example.com" required></div>
      <div class="form-field"><label>業種 <span class="req">*</span></label>
        <select id="category" class="form-input" required>
          <option value="">選択してください</option>
          <option value="飲食店">飲食店</option>
          <option value="カフェ">カフェ</option>
          <option value="バー・ラウンジ">バー・ラウンジ</option>
          <option value="ショッピング">ショッピング</option>
          <option value="エンターテインメント">エンターテインメント</option>
          <option value="旅行サービス">旅行サービス</option>
          <option value="美容">美容</option>
          <option value="体験・アクティビティ">体験・アクティビティ</option>
          <option value="宿泊">宿泊</option>
          <option value="その他">その他</option>
        </select>
      </div>
      <div class="form-field">
        <label>郵便番号（住所自動入力）</label>
        <div class="postal-row">
          <input type="text" id="postalCode" class="form-input" placeholder="例：5420076" inputmode="numeric" maxlength="8">
          <button type="button" class="postal-btn" id="postalSearchBtn" onclick="lookupPostalCode()">住所検索</button>
        </div>
        <div class="form-hint">ハイフンなし7桁で入力してください（例: 5420076）</div>
      </div>
      <div class="form-field"><label>地域 <span class="req">*</span></label><input type="text" id="area" class="form-input" placeholder="例：大阪府大阪市中央区" required></div>
      <div class="form-field"><label>住所 <span class="req">*</span></label><input type="text" id="address" class="form-input" placeholder="例：大阪市中央区難波1-1-1" required></div>
      <div class="form-field"><label>GoogleマップのURL <span class="req">*</span></label><input type="url" id="googleMapsUrl" class="form-input" placeholder="https://maps.google.com/..." required></div>
    </div>

    <!-- Section 2: Benefits -->
    <div class="form-section">
      <div class="form-section-header"><div class="form-section-num">2</div><h3>条件と特典の内容</h3></div>
      <div class="benefit-note">動画・画像でのPRを行うため、「目に見える特典」の方が高い集客効果が期待できます。</div>
      <div class="form-field">
        <label>利用条件 <span class="req">*</span></label>
        <div class="min-amount">
          <span>お会計</span>
          <input type="number" id="minAmount" class="form-input" placeholder="0000" style="width:110px;text-align:right" required>
          <span>円以上ご利用時</span>
        </div>
      </div>
      <div class="form-field">
        <label>特典内容 <span class="req">*</span></label>
        <p style="font-size:12px;color:#94A3B8;margin-bottom:12px">1枚につき1特典適用。提供する特典をチェックし、最大金額をご入力ください。</p>
      </div>
      <div class="benefit-row" id="benefitDiscount" onclick="toggleBenefit('discount')">
        <label class="benefit-label" onclick="event.stopPropagation()"><input type="checkbox" id="chkDiscount" onchange="syncBenefit('discount')"><span>お会計から10%割引</span></label>
        <div class="benefit-max hidden" id="maxDiscount"><span>最大</span><input type="number" id="maxDiscountAmt" class="form-input" placeholder="0000" onclick="event.stopPropagation()"><span>円まで</span></div>
      </div>
      <div class="benefit-row" id="benefitDrink" onclick="toggleBenefit('drink')">
        <label class="benefit-label" onclick="event.stopPropagation()"><input type="checkbox" id="chkDrink" onchange="syncBenefit('drink')"><span>ドリンク1杯無料</span></label>
        <div class="benefit-max hidden" id="maxDrink"><span>最大</span><input type="number" id="maxDrinkAmt" class="form-input" placeholder="0000" onclick="event.stopPropagation()"><span>円まで</span></div>
      </div>
      <div class="benefit-row" id="benefitSide" onclick="toggleBenefit('side')">
        <label class="benefit-label" onclick="event.stopPropagation()"><input type="checkbox" id="chkSide" onchange="syncBenefit('side')"><span>サイドメニュー1品無料</span></label>
        <div class="benefit-max hidden" id="maxSide"><span>最大</span><input type="number" id="maxSideAmt" class="form-input" placeholder="0000" onclick="event.stopPropagation()"><span>円まで</span></div>
      </div>
      <div class="benefit-row" id="benefitSizeUp" onclick="toggleBenefit('sizeUp')">
        <label class="benefit-label" onclick="event.stopPropagation()"><input type="checkbox" id="chkSizeUp" onchange="syncBenefit('sizeUp')"><span>サイズアップ1回無料</span></label>
        <div class="benefit-max hidden" id="maxSizeUp"><span>最大</span><input type="number" id="maxSizeUpAmt" class="form-input" placeholder="0000" onclick="event.stopPropagation()"><span>円まで</span></div>
      </div>
      <div class="benefit-tip">特典が充実しているほど、お客様がお店を選んで訪れる可能性が高くなります。</div>
    </div>

    <!-- Section 3: Business Hours -->
    <div class="form-section">
      <div class="form-section-header"><div class="form-section-num">3</div><h3>営業時間</h3></div>
      <div class="schedule-toggle">
        <div class="radio-opt active" id="optDaily" onclick="setSchedule('daily')"><div class="radio-dot"></div>毎日同じ</div>
        <div class="radio-opt" id="optWeekly" onclick="setSchedule('weekly')"><div class="radio-dot"></div>曜日別</div>
      </div>

      <div id="dailySection">
        <div class="time-row">
          <div><div class="time-label">開店</div><select id="dailyOpen" class="time-select"></select></div>
          <span class="time-separator" style="margin-top:16px">〜</span>
          <div><div class="time-label">閉店</div><select id="dailyClose" class="time-select"></select></div>
        </div>
        <label class="break-check"><input type="checkbox" id="hasBreak" onchange="toggleBreak()">休憩時間あり</label>
        <div class="break-times hidden" id="breakTimes">
          <select id="breakOpen" class="time-select time-select-small"></select>
          <span style="color:#94A3B8">〜</span>
          <select id="breakClose" class="time-select time-select-small"></select>
        </div>
        <div style="margin-top:16px">
          <p style="font-size:13px;font-weight:700;margin-bottom:8px">定休日</p>
          <div class="holiday-btns" id="holidayBtns"></div>
        </div>
      </div>

      <div id="weeklySection" class="hidden"></div>
    </div>

    <!-- Section 4: Store Introduction -->
    <div class="form-section">
      <div class="form-section-header"><div class="form-section-num">4</div><h3>店舗紹介</h3></div>
      <div class="form-field">
        <label>お店の特徴（一行紹介）<span class="req">*</span></label>
        <input type="text" id="storeIntro" class="form-input" maxlength="80" placeholder="例：難波駅徒歩3分、地元の人も並ぶ焼肉の名店" required>
        <div class="form-hint">位置 + コンセプト + 魅力ポイントを一文で</div>
      </div>
      <div class="form-field">
        <label>一押しメニュー（1〜3つ）</label>
        <div class="menu-row"><div class="menu-num">1</div><input type="text" id="menu1" class="form-input" placeholder="メニュー名"></div>
        <div class="menu-row"><div class="menu-num">2</div><input type="text" id="menu2" class="form-input" placeholder="メニュー名（任意）"></div>
        <div class="menu-row"><div class="menu-num">3</div><input type="text" id="menu3" class="form-input" placeholder="メニュー名（任意）"></div>
      </div>
      <div class="form-field">
        <label>ターゲット顧客（複数選択可）</label>
        <div class="target-btns" id="targetBtns"></div>
      </div>
    </div>

    <!-- Section 5: Photos & Links -->
    <div class="form-section">
      <div class="form-section-header"><div class="form-section-num">5</div><h3>写真・リンク</h3></div>
      <div class="form-field">
        <label>ウェブサイトおよびSNSのURL</label>
        <input type="url" id="websiteUrl" class="form-input" placeholder="https://...">
      </div>
      <div class="form-field">
        <label>店舗関連の画像</label>
        <div class="upload-area" onclick="document.getElementById('fileInput').click()">
          <div class="upload-title">写真をアップロード</div>
          <p class="upload-hint">JPG, PNG（最大6枚・自動圧縮）</p>
        </div>
        <input type="file" id="fileInput" multiple accept="image/*" style="display:none" onchange="handleFiles(this)">
        <div class="upload-preview" id="uploadPreview"></div>
        <p class="upload-status" id="uploadStatus"></p>
        <p class="upload-note">以下の資料をご提供いただけると、韓国人旅行者により正確な情報を提供できます。<br>メニュー表 / 店舗の外観・内装の写真 / サービスの写真 / 店舗ロゴ</p>
      </div>
    </div>

    <!-- Section 6: Utility Information -->
    <div class="form-section">
      <div class="form-section-header"><div class="form-section-num">6</div><h3>旅行者向け利便情報</h3></div>

      <div class="form-field">
        <label>決済手段（Payment Methods）</label>
        <div class="check-grid">
          <label class="check-chip"><input type="checkbox" id="utilPayCredit"><span class="check-chip-text">クレジットカード</span></label>
          <label class="check-chip"><input type="checkbox" id="utilPayPaypay"><span class="check-chip-text">PayPay</span></label>
          <label class="check-chip"><input type="checkbox" id="utilPayAlipay"><span class="check-chip-text">Alipay</span></label>
          <label class="check-chip"><input type="checkbox" id="utilPayCash"><span class="check-chip-text">現金</span></label>
        </div>
      </div>

      <div class="form-field">
        <label>言語対応（Language Support）</label>
        <div class="check-grid">
          <label class="check-chip"><input type="checkbox" id="utilLangKoMenu"><span class="check-chip-text">韓国語メニュー</span></label>
          <label class="check-chip"><input type="checkbox" id="utilLangEnMenu"><span class="check-chip-text">英語メニュー</span></label>
          <label class="check-chip"><input type="checkbox" id="utilLangKoStaff"><span class="check-chip-text">韓国語対応スタッフ</span></label>
        </div>
      </div>

      <div class="form-field" style="margin-bottom:0">
        <label>施設情報（Amenities）</label>
        <div class="check-grid">
          <label class="check-chip"><input type="checkbox" id="utilAmenityWifi"><span class="check-chip-text">無料Wi-Fi</span></label>
          <label class="check-chip"><input type="checkbox" id="utilAmenitySmoking"><span class="check-chip-text">喫煙席あり</span></label>
          <label class="check-chip"><input type="checkbox" id="utilAmenityNoSmoking"><span class="check-chip-text">全席禁煙</span></label>
          <label class="check-chip"><input type="checkbox" id="utilAmenityChildChair"><span class="check-chip-text">子ども用椅子</span></label>
          <label class="check-chip"><input type="checkbox" id="utilAmenityOutlet"><span class="check-chip-text">コンセント</span></label>
        </div>
      </div>
    </div>

    <!-- Agreement -->
    <div class="form-section" style="border-radius:14px">
      <h3 style="font-size:15px;font-weight:800;margin-bottom:14px">同意事項</h3>
      <div class="agree-list">
        <ol>
          <li>登録フォームを提出していただくと、確認完了後、62万人の会員様に特典と条件に関する内容が掲載されます。</li>
          <li>提携にあたり、すべての従業員・スタッフの方に提携内容を必ず共有してください。</li>
          <li>会員様が特典を受けられないことがないよう、確実な対応の徹底をお願いします。</li>
          <li>提携完了後は、弊社オリジナルロゴステッカーを配布いたします。店舗入り口の見える位置にお貼りください。</li>
          <li>お客様は注文前にフライングパスを提示します。</li>
          <li>フライングパス1枚につき、特典は1つご提供ください。</li>
        </ol>
      </div>
      <label class="agree-check" id="agreeCheck" onclick="toggleAgree()">
        <input type="checkbox" id="agreeBox" onclick="event.stopPropagation()" onchange="syncAgree()">
        <span>上記の同意事項に同意します</span>
      </label>
    </div>

    <!-- Error -->
    <div class="submit-error hidden" id="submitError"></div>

    <!-- Submit -->
    <button class="submit-btn disabled" id="submitBtn" onclick="handleSubmit()" disabled>登録する</button>
    <p class="submit-hint">送信後、LINEビジネスチャネルの友だち追加画面が表示されます</p>
  </div>
</div>

<!-- =================== SUCCESS PAGE =================== -->
<div id="successPage" class="hidden">
  <div class="success-page">
    <div class="success-card">
      <div class="success-icon">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
      </div>
      <h2>ご登録ありがとうございます</h2>
      <p>登録内容を確認次第、ご連絡いたします。<br>続いて、<strong>LINEビジネスチャネル</strong>を<br>友だち追加してください。</p>
      <a href="https://line.me/R/ti/p/@864mbroc" target="_blank" class="line-btn line-btn-big">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="white"><path d="M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63h2.386c.346 0 .627.285.627.63 0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211 0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346 0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195 0 .375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345 0 .63.285.63.63v4.771zm-5.741 0c0 .344-.282.629-.631.629-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63.346 0 .628.285.628.63v4.771zm-2.466.629H4.917c-.345 0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.63 0 .344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314"/></svg>
        LINEで友だち追加する
      </a>
      <div id="countdown" class="countdown"></div>
      <div id="postUploadStatus" class="post-upload-status"></div>
      <button id="retryUploadBtn" class="post-upload-retry hidden" onclick="retryFailedUploads()">失敗した画像を再アップロード</button>
      <div class="success-note">今後の提携に関する全てのご案内は<br>LINEチャネルを通じて配信されます。</div>
    </div>
  </div>
</div>

<script>
// ====== STATE ======
var scheduleType = 'daily';
var holidays = [];
var targets = [];
var uploadedFiles = []; // { name, type, data (base64) }
var agreed = false;
var submitting = false;
var submitWatchdogTimer = null;
var postSubmitUploading = false;
var postUploadSession = null;

var LINE_URL = 'https://line.me/R/ti/p/@864mbroc';
var DAYS = ['月','火','水','木','金','土','日'];
var TARGET_OPTIONS = [
  {id:'couple',label:'カップル'},{id:'family',label:'ファミリー'},
  {id:'solo',label:'おひとりさま'},{id:'group',label:'団体'},
  {id:'drinking',label:'飲み会'},{id:'dinner',label:'ディナー'},
  {id:'lunch',label:'ランチ'},{id:'dessert',label:'デザート'}
];
var BENEFIT_TYPES = ['discount', 'drink', 'side', 'sizeUp'];
var DRAFT_KEY = 'flying_pass_partner_form_draft_v1';
var autosaveBound = false;
var saveTimer = null;
var MAX_UPLOAD_COUNT = 6;
var MAX_IMAGE_SIDE = 1600;
var IMAGE_QUALITY = 0.82;
var MAX_IMAGE_BYTES = 1200 * 1024;
var UTILITY_CHECK_IDS = [
  'utilPayCredit','utilPayPaypay','utilPayAlipay','utilPayCash',
  'utilLangKoMenu','utilLangEnMenu','utilLangKoStaff',
  'utilAmenityWifi','utilAmenitySmoking','utilAmenityNoSmoking','utilAmenityChildChair','utilAmenityOutlet'
];

// ====== INIT ======
window.onload = function() {
  buildTimeOptions();
  buildHolidayBtns();
  buildWeeklySection();
  buildTargetBtns();
  restoreDraft();
  syncCheckChipStates();
  updateUploadStatus();
  bindAutosave();
};

// ====== PAGE NAVIGATION ======
function showForm() {
  document.getElementById('infoPage').classList.add('hidden');
  document.getElementById('formPage').classList.remove('hidden');
  window.scrollTo(0,0);
}
function showInfo() {
  document.getElementById('formPage').classList.add('hidden');
  document.getElementById('infoPage').classList.remove('hidden');
  window.scrollTo(0,0);
}
function showSuccess() {
  document.getElementById('formPage').classList.add('hidden');
  document.getElementById('successPage').classList.remove('hidden');
  window.scrollTo(0,0);
  // Countdown
  var count = 5;
  var el = document.getElementById('countdown');
  el.textContent = count + '秒後に自動でLINE画面が開きます...';
  var timer = setInterval(function(){
    count--;
    if(count <= 0){
      clearInterval(timer);
      el.textContent = '';
      window.open(LINE_URL, '_blank');
    } else {
      el.textContent = count + '秒後に自動でLINE画面が開きます...';
    }
  }, 1000);
}

function setPostUploadStatus(text, isError) {
  var el = document.getElementById('postUploadStatus');
  if (!el) return;
  el.textContent = text || '';
  el.style.color = isError ? '#FCA5A5' : 'rgba(255,255,255,0.75)';
}

function setRetryUploadButton(show, label) {
  var btn = document.getElementById('retryUploadBtn');
  if (!btn) return;
  btn.textContent = label || '失敗した画像を再アップロード';
  btn.className = 'post-upload-retry' + (show ? '' : ' hidden');
}


// ====== TIME OPTIONS ======
function buildTimeOptions() {
  var opts = '<option value="">--:--</option>';
  for(var h=6; h<=26; h++){
    for(var m=0; m<60; m+=30){
      if(h===26 && m>0) break;
      var hh = String(h).padStart(2,'0');
      var mm = String(m).padStart(2,'0');
      opts += '<option value="'+hh+':'+mm+'">'+hh+':'+mm+'</option>';
    }
  }
  ['dailyOpen','dailyClose','breakOpen','breakClose'].forEach(function(id){
    document.getElementById(id).innerHTML = opts;
  });
}

// ====== SCHEDULE ======
function setSchedule(type) {
  scheduleType = type;
  document.getElementById('optDaily').className = 'radio-opt' + (type==='daily' ? ' active' : '');
  document.getElementById('optWeekly').className = 'radio-opt' + (type==='weekly' ? ' active' : '');
  document.getElementById('dailySection').className = type==='daily' ? '' : 'hidden';
  document.getElementById('weeklySection').className = type==='weekly' ? '' : 'hidden';
  queueSaveDraft();
}

function toggleBreak() {
  var checked = document.getElementById('hasBreak').checked;
  document.getElementById('breakTimes').className = checked ? 'break-times' : 'break-times hidden';
  queueSaveDraft();
}

// ====== HOLIDAY BUTTONS ======
function buildHolidayBtns() {
  var html = '';
  DAYS.forEach(function(d){
    html += '<button class="holiday-btn" onclick="toggleHoliday(\''+d+'\')">'+d+'</button>';
  });
  html += '<button class="holiday-btn nenkyu" onclick="toggleHoliday(\'年中無休\')">年中無休</button>';
  document.getElementById('holidayBtns').innerHTML = html;
}

function toggleHoliday(day) {
  if(day === '年中無休') {
    holidays = ['年中無休'];
  } else {
    holidays = holidays.filter(function(d){ return d !== '年中無休'; });
    var idx = holidays.indexOf(day);
    if(idx >= 0) holidays.splice(idx,1);
    else holidays.push(day);
  }
  updateHolidayBtns();
  queueSaveDraft();
}

function updateHolidayBtns() {
  var btns = document.getElementById('holidayBtns').children;
  for(var i=0; i<btns.length; i++){
    var text = btns[i].textContent;
    var isNenkyu = text === '年中無休';
    var isActive = holidays.indexOf(text) >= 0;
    btns[i].className = 'holiday-btn' + (isNenkyu ? ' nenkyu' : '') + (isActive ? ' active' : '');
  }
}

// ====== WEEKLY SECTION ======
function buildWeeklySection() {
  var opts = '<option value="">--:--</option>';
  for(var h=6; h<=26; h++){
    for(var m=0; m<60; m+=30){
      if(h===26 && m>0) break;
      var hh = String(h).padStart(2,'0');
      var mm = String(m).padStart(2,'0');
      opts += '<option value="'+hh+':'+mm+'">'+hh+':'+mm+'</option>';
    }
  }
  var html = '';
  DAYS.forEach(function(d){
    html += '<div class="weekly-row" id="weekRow_'+d+'">';
    html += '<span class="weekly-day">'+d+'</span>';
    html += '<select class="time-select time-select-small" id="wOpen_'+d+'">'+opts+'</select>';
    html += '<span style="color:#94A3B8">〜</span>';
    html += '<select class="time-select time-select-small" id="wClose_'+d+'">'+opts+'</select>';
    html += '<label class="weekly-close-label"><input type="checkbox" id="wClosed_'+d+'" onchange="toggleWeekDay(\''+d+'\')">休み</label>';
    html += '</div>';
  });
  document.getElementById('weeklySection').innerHTML = html;
}

function toggleWeekDay(day) {
  var closed = document.getElementById('wClosed_'+day).checked;
  var row = document.getElementById('weekRow_'+day);
  row.className = 'weekly-row' + (closed ? ' closed' : '');
  document.getElementById('wOpen_'+day).style.display = closed ? 'none' : '';
  document.getElementById('wClose_'+day).style.display = closed ? 'none' : '';
  row.querySelectorAll('span')[0].style.display = closed ? 'none' : '';
  var dayEl = row.querySelector('.weekly-day');
  dayEl.className = 'weekly-day' + (closed ? ' off' : '');
  queueSaveDraft();
}

// ====== BENEFITS ======
function toggleBenefit(type) {
  selectSingleBenefit(type);
}

function syncBenefit(type) {
  selectSingleBenefit(type);
}

function updateBenefitRow(type, isChecked) {
  var map = {discount:'Discount', drink:'Drink', side:'Side', sizeUp:'SizeUp'};
  var row = document.getElementById('benefit'+map[type]);
  var maxDiv = document.getElementById('max'+map[type]);
  if(isChecked) {
    row.className = 'benefit-row active';
    maxDiv.className = 'benefit-max';
  } else {
    row.className = 'benefit-row';
    maxDiv.className = 'benefit-max hidden';
  }
  queueSaveDraft();
}

function selectSingleBenefit(type) {
  var map = {discount:'Discount', drink:'Drink', side:'Side', sizeUp:'SizeUp'};
  BENEFIT_TYPES.forEach(function(t){
    var chk = document.getElementById('chk' + map[t]);
    if (!chk) return;
    chk.checked = (t === type);
    updateBenefitRow(t, chk.checked);
  });
}

function getSelectedBenefitCount() {
  var map = {discount:'Discount', drink:'Drink', side:'Side', sizeUp:'SizeUp'};
  return BENEFIT_TYPES.reduce(function(acc, t){
    var chk = document.getElementById('chk' + map[t]);
    return acc + ((chk && chk.checked) ? 1 : 0);
  }, 0);
}

function normalizeBenefitSelectionFromDraft() {
  var map = {discount:'Discount', drink:'Drink', side:'Side', sizeUp:'SizeUp'};
  var selected = BENEFIT_TYPES.filter(function(t){
    var chk = document.getElementById('chk' + map[t]);
    return !!(chk && chk.checked);
  });
  if (selected.length > 1) {
    selectSingleBenefit(selected[0]);
    return;
  }
  BENEFIT_TYPES.forEach(function(t){
    var chk = document.getElementById('chk' + map[t]);
    updateBenefitRow(t, !!(chk && chk.checked));
  });
}

// ====== TARGETS ======
function buildTargetBtns() {
  var html = '';
  TARGET_OPTIONS.forEach(function(t){
    html += '<button class="target-btn" id="target_'+t.id+'" onclick="toggleTarget(\''+t.id+'\')">'+t.label+'</button>';
  });
  document.getElementById('targetBtns').innerHTML = html;
}

function toggleTarget(id) {
  var idx = targets.indexOf(id);
  if(idx >= 0) targets.splice(idx,1);
  else targets.push(id);
  TARGET_OPTIONS.forEach(function(t){
    var el = document.getElementById('target_'+t.id);
    el.className = 'target-btn' + (targets.indexOf(t.id)>=0 ? ' active' : '');
  });
  queueSaveDraft();
}

// ====== FILE UPLOAD ======
function handleFiles(input) {
  var files = Array.prototype.slice.call(input.files || []);
  if (!files.length) return;

  var remain = MAX_UPLOAD_COUNT - uploadedFiles.length;
  if (remain <= 0) {
    alert('画像は最大' + MAX_UPLOAD_COUNT + '枚までです。');
    input.value = '';
    return;
  }
  if (files.length > remain) {
    alert('画像は最大' + MAX_UPLOAD_COUNT + '枚までです。先頭' + remain + '枚のみ追加します。');
    files = files.slice(0, remain);
  }

  var statusEl = document.getElementById('uploadStatus');
  var index = 0;

  function next() {
    if (index >= files.length) {
      renderPreviews();
      updateUploadStatus();
      queueSaveDraft();
      input.value = '';
      return;
    }

    var file = files[index++];
    if (!file.type || file.type.indexOf('image/') !== 0) {
      next();
      return;
    }

    if (statusEl) statusEl.textContent = '画像を最適化中... (' + index + '/' + files.length + ')';

    compressImageFile(file)
      .then(function(comp) {
        uploadedFiles.push(comp);
      })
      .catch(function() {
        alert(file.name + ' の処理に失敗しました。');
      })
      .finally(next);
  }

  next();
}

function readFileAsDataURL(file) {
  return new Promise(function(resolve, reject) {
    var reader = new FileReader();
    reader.onload = function(e) { resolve(e.target.result); };
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

function loadImageFromUrl(url) {
  return new Promise(function(resolve, reject) {
    var img = new Image();
    img.onload = function() { resolve(img); };
    img.onerror = reject;
    img.src = url;
  });
}

function compressImageFile(file) {
  return readFileAsDataURL(file).then(function(url) {
    return loadImageFromUrl(url);
  }).then(function(img) {
    var w = img.naturalWidth || img.width;
    var h = img.naturalHeight || img.height;
    var ratio = Math.min(1, MAX_IMAGE_SIDE / Math.max(w, h));
    var tw = Math.max(1, Math.round(w * ratio));
    var th = Math.max(1, Math.round(h * ratio));

    var canvas = document.createElement('canvas');
    canvas.width = tw;
    canvas.height = th;
    var ctx = canvas.getContext('2d');
    ctx.drawImage(img, 0, 0, tw, th);

    var quality = IMAGE_QUALITY;
    var output = canvas.toDataURL('image/jpeg', quality);
    var base64 = output.split(',')[1];
    while ((base64.length * 3 / 4) > MAX_IMAGE_BYTES && quality > 0.5) {
      quality -= 0.1;
      output = canvas.toDataURL('image/jpeg', quality);
      base64 = output.split(',')[1];
    }

    return {
      name: file.name.replace(/\.[^.]+$/, '') + '.jpg',
      type: 'image/jpeg',
      data: base64
    };
  });
}

function renderPreviews() {
  var html = '';
  uploadedFiles.forEach(function(f, idx){
    html += '<div class="upload-item">';
    html += '<img class="upload-thumb" src="data:'+f.type+';base64,'+f.data+'">';
    html += '<button class="upload-remove" onclick="removeFile('+idx+')">×</button>';
    html += '</div>';
  });
  document.getElementById('uploadPreview').innerHTML = html;
  updateUploadStatus();
}

function removeFile(idx) {
  uploadedFiles.splice(idx, 1);
  renderPreviews();
  queueSaveDraft();
}

function updateUploadStatus() {
  var statusEl = document.getElementById('uploadStatus');
  if (!statusEl) return;
  var totalBytes = uploadedFiles.reduce(function(acc, f) {
    return acc + Math.floor((f.data || '').length * 3 / 4);
  }, 0);
  statusEl.textContent = uploadedFiles.length + '/' + MAX_UPLOAD_COUNT + ' 枚, 約 ' + Math.round(totalBytes / 1024) + 'KB';
}

// ====== POSTAL LOOKUP ======
function lookupPostalCode() {
  var postalEl = document.getElementById('postalCode');
  var btn = document.getElementById('postalSearchBtn');
  var raw = (postalEl.value || '').trim();
  var code = raw.replace(/\D/g, '');

  if (code.length !== 7) {
    alert('郵便番号は7桁で入力してください。');
    postalEl.focus();
    return;
  }

  btn.disabled = true;
  btn.textContent = '検索中...';

  fetch('https://zipcloud.ibsnet.co.jp/api/search?zipcode=' + code)
    .then(function(res){ return res.json(); })
    .then(function(data){
      if (!data || data.status !== 200 || !data.results || !data.results.length) {
        throw new Error((data && data.message) || '住所が見つかりませんでした。');
      }

      var result = data.results[0];
      var areaText = (result.address1 || '') + (result.address2 || '');
      var areaEl = document.getElementById('area');

      if (!areaEl.value.trim()) areaEl.value = areaText;
      postalEl.value = code;
      queueSaveDraft();
    })
    .catch(function(err){
      alert('住所検索に失敗しました。郵便番号をご確認ください。');
    })
    .finally(function(){
      btn.disabled = false;
      btn.textContent = '住所検索';
    });
}

// ====== AGREEMENT ======
function toggleAgree() {
  var chk = document.getElementById('agreeBox');
  chk.checked = !chk.checked;
  syncAgree();
}

function syncAgree() {
  var chk = document.getElementById('agreeBox');
  agreed = chk.checked;
  var el = document.getElementById('agreeCheck');
  el.className = 'agree-check' + (agreed ? ' active' : '');
  var btn = document.getElementById('submitBtn');
  btn.disabled = !agreed;
  btn.className = 'submit-btn ' + (agreed ? 'ready' : 'disabled');
  queueSaveDraft();
}

// ====== DRAFT SAVE/RESTORE ======
function bindAutosave() {
  if (autosaveBound) return;
  autosaveBound = true;

  var formPage = document.getElementById('formPage');
  if (formPage) {
    formPage.addEventListener('input', queueSaveDraft);
    formPage.addEventListener('change', queueSaveDraft);
    formPage.addEventListener('change', syncCheckChipStates);
  }
  window.addEventListener('beforeunload', saveDraft);
}

function queueSaveDraft() {
  if (saveTimer) clearTimeout(saveTimer);
  saveTimer = setTimeout(saveDraft, 150);
}

function getFieldValue(id) {
  var el = document.getElementById(id);
  return el ? el.value : '';
}

function setFieldValue(id, value) {
  var el = document.getElementById(id);
  if (el && typeof value !== 'undefined' && value !== null) el.value = value;
}

function collectDraft() {
  var weekly = {};
  DAYS.forEach(function(d){
    weekly[d] = {
      open: getFieldValue('wOpen_' + d),
      close: getFieldValue('wClose_' + d),
      closed: !!(document.getElementById('wClosed_' + d) && document.getElementById('wClosed_' + d).checked)
    };
  });

  return {
    scheduleType: scheduleType,
    holidays: holidays.slice(),
    targets: targets.slice(),
    agreed: agreed,
    fields: {
      companyName: getFieldValue('companyName'),
      contactName: getFieldValue('contactName'),
      contactInfo: getFieldValue('contactInfo'),
      email: getFieldValue('email'),
      category: getFieldValue('category'),
      postalCode: getFieldValue('postalCode'),
      area: getFieldValue('area'),
      address: getFieldValue('address'),
      googleMapsUrl: getFieldValue('googleMapsUrl'),
      websiteUrl: getFieldValue('websiteUrl'),
      minAmount: getFieldValue('minAmount'),
      storeIntro: getFieldValue('storeIntro'),
      menu1: getFieldValue('menu1'),
      menu2: getFieldValue('menu2'),
      menu3: getFieldValue('menu3'),
      dailyOpen: getFieldValue('dailyOpen'),
      dailyClose: getFieldValue('dailyClose'),
      hasBreak: !!(document.getElementById('hasBreak') && document.getElementById('hasBreak').checked),
      breakOpen: getFieldValue('breakOpen'),
      breakClose: getFieldValue('breakClose'),
      chkDiscount: !!(document.getElementById('chkDiscount') && document.getElementById('chkDiscount').checked),
      chkDrink: !!(document.getElementById('chkDrink') && document.getElementById('chkDrink').checked),
      chkSide: !!(document.getElementById('chkSide') && document.getElementById('chkSide').checked),
      chkSizeUp: !!(document.getElementById('chkSizeUp') && document.getElementById('chkSizeUp').checked),
      maxDiscountAmt: getFieldValue('maxDiscountAmt'),
      maxDrinkAmt: getFieldValue('maxDrinkAmt'),
      maxSideAmt: getFieldValue('maxSideAmt'),
      maxSizeUpAmt: getFieldValue('maxSizeUpAmt'),
      utilPayCredit: !!(document.getElementById('utilPayCredit') && document.getElementById('utilPayCredit').checked),
      utilPayPaypay: !!(document.getElementById('utilPayPaypay') && document.getElementById('utilPayPaypay').checked),
      utilPayAlipay: !!(document.getElementById('utilPayAlipay') && document.getElementById('utilPayAlipay').checked),
      utilPayCash: !!(document.getElementById('utilPayCash') && document.getElementById('utilPayCash').checked),
      utilLangKoMenu: !!(document.getElementById('utilLangKoMenu') && document.getElementById('utilLangKoMenu').checked),
      utilLangEnMenu: !!(document.getElementById('utilLangEnMenu') && document.getElementById('utilLangEnMenu').checked),
      utilLangKoStaff: !!(document.getElementById('utilLangKoStaff') && document.getElementById('utilLangKoStaff').checked),
      utilAmenityWifi: !!(document.getElementById('utilAmenityWifi') && document.getElementById('utilAmenityWifi').checked),
      utilAmenitySmoking: !!(document.getElementById('utilAmenitySmoking') && document.getElementById('utilAmenitySmoking').checked),
      utilAmenityNoSmoking: !!(document.getElementById('utilAmenityNoSmoking') && document.getElementById('utilAmenityNoSmoking').checked),
      utilAmenityChildChair: !!(document.getElementById('utilAmenityChildChair') && document.getElementById('utilAmenityChildChair').checked),
      utilAmenityOutlet: !!(document.getElementById('utilAmenityOutlet') && document.getElementById('utilAmenityOutlet').checked)
    },
    weekly: weekly
  };
}

function saveDraft() {
  try {
    var data = collectDraft();
    localStorage.setItem(DRAFT_KEY, JSON.stringify(data));
  } catch (e) {
  }
}

function restoreDraft() {
  try {
    var raw = localStorage.getItem(DRAFT_KEY);
    if (!raw) return;
    var draft = JSON.parse(raw);
    if (!draft || !draft.fields) return;

    Object.keys(draft.fields).forEach(function(key){
      if (key === 'hasBreak' || key.indexOf('chk') === 0 || key.indexOf('util') === 0) return;
      setFieldValue(key, draft.fields[key]);
    });

    var hasBreakEl = document.getElementById('hasBreak');
    if (hasBreakEl) hasBreakEl.checked = !!draft.fields.hasBreak;
    toggleBreak();

    ['Discount', 'Drink', 'Side', 'SizeUp'].forEach(function(name){
      var el = document.getElementById('chk' + name);
      if (el) el.checked = !!draft.fields['chk' + name];
    });
    normalizeBenefitSelectionFromDraft();

    scheduleType = draft.scheduleType === 'weekly' ? 'weekly' : 'daily';
    setSchedule(scheduleType);

    if (draft.weekly) {
      DAYS.forEach(function(d){
        var item = draft.weekly[d] || {};
        setFieldValue('wOpen_' + d, item.open || '');
        setFieldValue('wClose_' + d, item.close || '');
        var closedEl = document.getElementById('wClosed_' + d);
        if (closedEl) closedEl.checked = !!item.closed;
        toggleWeekDay(d);
      });
    }

    holidays = Array.isArray(draft.holidays) ? draft.holidays : [];
    updateHolidayBtns();

    targets = Array.isArray(draft.targets) ? draft.targets : [];
    TARGET_OPTIONS.forEach(function(t){
      var el = document.getElementById('target_' + t.id);
      if (el) el.className = 'target-btn' + (targets.indexOf(t.id)>=0 ? ' active' : '');
    });

    var agreeEl = document.getElementById('agreeBox');
    if (agreeEl) agreeEl.checked = !!draft.agreed;
    UTILITY_CHECK_IDS.forEach(function(id){
      var el = document.getElementById(id);
      if (el) el.checked = !!draft.fields[id];
    });
    syncCheckChipStates();
    syncAgree();
  } catch (e) {
  }
}

function clearDraft() {
  try {
    localStorage.removeItem(DRAFT_KEY);
  } catch (e) {
  }
}

// ====== BUILD FORM DATA ======
function getBusinessHours() {
  if(scheduleType === 'daily') {
    var open = document.getElementById('dailyOpen').value || '--:--';
    var close = document.getElementById('dailyClose').value || '--:--';
    var text = open + ' 〜 ' + close;
    if(document.getElementById('hasBreak').checked) {
      var bo = document.getElementById('breakOpen').value || '--:--';
      var bc = document.getElementById('breakClose').value || '--:--';
      text += ' / 休憩 ' + bo + ' 〜 ' + bc;
    }
    return text;
  } else {
    var parts = [];
    DAYS.forEach(function(d){
      if(document.getElementById('wClosed_'+d).checked) {
        parts.push(d + ': 休み');
      } else {
        var o = document.getElementById('wOpen_'+d).value || '--:--';
        var c = document.getElementById('wClose_'+d).value || '--:--';
        parts.push(d + ': ' + o + ' 〜 ' + c);
      }
    });
    return parts.join(' / ');
  }
}

function getHolidays() {
  if(scheduleType === 'weekly') {
    var closed = [];
    DAYS.forEach(function(d){
      if(document.getElementById('wClosed_'+d).checked) closed.push(d);
    });
    return closed.length > 0 ? closed.join('・') : 'なし';
  }
  return holidays.length > 0 ? holidays.join('・') : '未選択';
}

// ====== SUBMIT ======
function handleSubmit() {
  if(!agreed || submitting) return;

  // 필수 입력 체크
  var required = ['companyName','contactName','contactInfo','email','category','area','address','googleMapsUrl','minAmount','storeIntro'];
  for(var i=0; i<required.length; i++){
    var val = document.getElementById(required[i]).value.trim();
    if(!val) {
      alert('必須項目をすべてご入力ください。');
      document.getElementById(required[i]).focus();
      return;
    }
  }
  if (getSelectedBenefitCount() !== 1) {
    alert('特典内容は1つだけ選択してください。');
    return;
  }

  submitting = true;
  var btn = document.getElementById('submitBtn');
  btn.innerHTML = '<div class="spinner"></div> 送信中...';
  btn.className = 'submit-btn disabled';
  document.getElementById('submitError').classList.add('hidden');
  clearTimeout(submitWatchdogTimer);
  submitWatchdogTimer = setTimeout(function(){
    if (!submitting) return;
    submitting = false;
    btn.innerHTML = '登録する';
    btn.className = 'submit-btn ready';
    var timeoutErr = document.getElementById('submitError');
    timeoutErr.textContent = '送信に時間がかかっています。画像枚数を減らして再試行してください。';
    timeoutErr.classList.remove('hidden');
  }, 65000);

  // 메뉴
  var menus = [
    document.getElementById('menu1').value,
    document.getElementById('menu2').value,
    document.getElementById('menu3').value
  ].filter(function(m){ return m.trim(); }).join(' / ');

  // 타겟
  var targetLabels = targets.map(function(id){
    var t = TARGET_OPTIONS.find(function(o){ return o.id === id; });
    return t ? t.label : id;
  }).join('・');

  var formData = {
    companyName: document.getElementById('companyName').value,
    contactName: document.getElementById('contactName').value,
    contactInfo: document.getElementById('contactInfo').value,
    email: document.getElementById('email').value,
    postalCode: document.getElementById('postalCode').value,
    category: document.getElementById('category').value,
    area: document.getElementById('area').value,
    address: document.getElementById('address').value,
    googleMapsUrl: document.getElementById('googleMapsUrl').value,
    websiteUrl: document.getElementById('websiteUrl').value,
    minAmount: document.getElementById('minAmount').value,
    benefits: {
      discount: { checked: document.getElementById('chkDiscount').checked, maxAmount: document.getElementById('maxDiscountAmt').value },
      drink: { checked: document.getElementById('chkDrink').checked, maxAmount: document.getElementById('maxDrinkAmt').value },
      side: { checked: document.getElementById('chkSide').checked, maxAmount: document.getElementById('maxSideAmt').value },
      sizeUp: { checked: document.getElementById('chkSizeUp').checked, maxAmount: document.getElementById('maxSizeUpAmt').value }
    },
    businessHours: getBusinessHours(),
    holidays: getHolidays(),
    storeIntro: document.getElementById('storeIntro').value,
    recommendedMenus: menus,
    targets: targetLabels,
    paymentMethods: collectCheckedLabels([
      { id: 'utilPayCredit', label: 'クレジットカード' },
      { id: 'utilPayPaypay', label: 'PayPay' },
      { id: 'utilPayAlipay', label: 'Alipay' },
      { id: 'utilPayCash', label: '現金' }
    ]),
    languageSupport: collectCheckedLabels([
      { id: 'utilLangKoMenu', label: '韓国語メニュー' },
      { id: 'utilLangEnMenu', label: '英語メニュー' },
      { id: 'utilLangKoStaff', label: '韓国語対応スタッフ' }
    ]),
    amenities: collectCheckedLabels([
      { id: 'utilAmenityWifi', label: '無料Wi-Fi' },
      { id: 'utilAmenitySmoking', label: '喫煙席あり' },
      { id: 'utilAmenityNoSmoking', label: '全席禁煙' },
      { id: 'utilAmenityChildChair', label: '子ども用椅子' },
      { id: 'utilAmenityOutlet', label: 'コンセント' }
    ]),
    images: []
  };
  var deferredImages = uploadedFiles.slice();

  google.script.run
    .withSuccessHandler(function(result){
      clearTimeout(submitWatchdogTimer);
      submitting = false;
      if(result && result.success) {
        clearDraft();
        showSuccess();
        if (deferredImages.length && result.submissionId) {
          postUploadSession = {
            submissionId: result.submissionId,
            companyName: formData.companyName,
            images: deferredImages.slice(),
            folderId: '',
            failedIndices: []
          };
          uploadImagesDeferred(result.submissionId, formData.companyName, deferredImages);
        } else {
          setPostUploadStatus('');
          setRetryUploadButton(false);
        }
      } else {
        btn.innerHTML = '登録する';
        btn.className = 'submit-btn ready';
        var errEl = document.getElementById('submitError');
        errEl.textContent = (result && result.message) || '送信中にエラーが発生しました。もう一度お試しください。';
        errEl.classList.remove('hidden');
      }
    })
    .withFailureHandler(function(error){
      clearTimeout(submitWatchdogTimer);
      submitting = false;
      btn.innerHTML = '登録する';
      btn.className = 'submit-btn ready';
      var errEl = document.getElementById('submitError');
      errEl.textContent = '送信中にエラーが発生しました。もう一度お試しください。';
      errEl.classList.remove('hidden');
    })
    .submitForm(formData);
}

function uploadImagesDeferred(submissionId, companyName, images) {
  if (!images || !images.length || postSubmitUploading) return;
  postSubmitUploading = true;
  setRetryUploadButton(false);
  var failed = [];
  var queue = images.map(function(_, idx){ return idx; });

  function uploadOne(originalIdx, done) {
    var retryCount = 0;
    function send() {
      google.script.run
        .withSuccessHandler(function(res){
          if (res && res.success) {
            if (postUploadSession) postUploadSession.folderId = res.folderId || postUploadSession.folderId;
            done(true);
            return;
          }
          if (retryCount < 1) {
            retryCount++;
            send();
            return;
          }
          done(false);
        })
        .withFailureHandler(function(){
          if (retryCount < 1) {
            retryCount++;
            send();
            return;
          }
          done(false);
        })
        .uploadSubmissionImage({
          submissionId: submissionId,
          companyName: companyName,
          folderId: (postUploadSession && postUploadSession.folderId) || '',
          imageOrder: originalIdx + 1,
          image: images[originalIdx]
        });
    }
    send();
  }

  function uploadNext() {
    if (!queue.length) {
      postSubmitUploading = false;
      if (postUploadSession) postUploadSession.failedIndices = failed.slice();
      var okCount = images.length - failed.length;
      if (!failed.length) {
        setPostUploadStatus('画像アップロード完了 (' + okCount + '/' + images.length + ')');
        setRetryUploadButton(false);
      } else {
        setPostUploadStatus('画像アップロード一部失敗 (' + okCount + '/' + images.length + ')');
        setRetryUploadButton(true, '失敗した画像を再アップロード (' + failed.length + '件)');
      }
      return;
    }

    var originalIdx = queue.shift();
    var sentCount = images.length - queue.length;
    setPostUploadStatus('画像アップロード中... (' + sentCount + '/' + images.length + ')');

    uploadOne(originalIdx, function(ok){
      if (!ok) failed.push(originalIdx);
      uploadNext();
    });
  }

  uploadNext();
}

function retryFailedUploads() {
  if (!postUploadSession || !postUploadSession.failedIndices || !postUploadSession.failedIndices.length) return;
  if (postSubmitUploading) return;

  var retryIndices = postUploadSession.failedIndices.slice();
  var sessionImages = postUploadSession.images;
  var total = retryIndices.length;
  postSubmitUploading = true;
  setRetryUploadButton(false);

  function nextRetry() {
    if (!retryIndices.length) {
      postSubmitUploading = false;
      setPostUploadStatus('失敗画像の再アップロード完了');
      postUploadSession.failedIndices = [];
      setRetryUploadButton(false);
      return;
    }

    var originalIdx = retryIndices.shift();
    var done = total - retryIndices.length;
    setPostUploadStatus('失敗画像を再アップロード中... (' + done + '/' + total + ')');

    google.script.run
      .withSuccessHandler(function(res){
        if (res && res.success) {
          postUploadSession.folderId = res.folderId || postUploadSession.folderId;
          nextRetry();
          return;
        }
        retryIndices.push(originalIdx);
        postSubmitUploading = false;
        postUploadSession.failedIndices = retryIndices.slice();
        setPostUploadStatus('再アップロードに失敗しました。時間をおいて再試行してください。', true);
        setRetryUploadButton(true, '失敗した画像を再アップロード (' + retryIndices.length + '件)');
      })
      .withFailureHandler(function(){
        retryIndices.push(originalIdx);
        postSubmitUploading = false;
        postUploadSession.failedIndices = retryIndices.slice();
        setPostUploadStatus('再アップロードに失敗しました。時間をおいて再試行してください。', true);
        setRetryUploadButton(true, '失敗した画像を再アップロード (' + retryIndices.length + '件)');
      })
      .uploadSubmissionImage({
        submissionId: postUploadSession.submissionId,
        companyName: postUploadSession.companyName,
        folderId: postUploadSession.folderId || '',
        imageOrder: originalIdx + 1,
        image: sessionImages[originalIdx]
      });
  }

  nextRetry();
}

function syncCheckChipStates() {
  var chips = document.querySelectorAll('.check-chip');
  for (var i = 0; i < chips.length; i++) {
    var chk = chips[i].querySelector('input[type="checkbox"]');
    if (!chk) continue;
    chips[i].className = 'check-chip' + (chk.checked ? ' active' : '');
  }
}

function collectCheckedLabels(items) {
  return items.filter(function(item){
    var el = document.getElementById(item.id);
    return !!(el && el.checked);
  }).map(function(item){
    return item.label;
  }).join(' / ');
}
</script>
</body>
</html>


